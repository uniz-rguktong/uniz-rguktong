generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Outpass {
  id            String   @id @default(uuid())
  studentId     String   // Reference to User ID
  studentGender String   @default("M") // Added for gender-based filtering
  reason        String
  fromDay       DateTime
  toDay         DateTime
  days          Int      @default(0)
  requestedTime DateTime @default(now())
  
  isExpired     Boolean  @default(false)
  isApproved    Boolean  @default(false)
  isRejected    Boolean  @default(false)
  
  issuedBy       String   @default("none")
  issuedTime     DateTime @default(now())
  message        String?
  rejectedBy     String   @default("none")
  rejectedTime   DateTime @default(now())
  
  checkedOutTime DateTime?
  checkedInTime  DateTime?
  
  currentLevel   String   @default("caretaker")
  approvalLogs   Json?    // Typed as ApprovalLogsSchema in code

  @@index([studentId])
  @@index([isApproved, isRejected, isExpired])
}

model Outing {
  id             String   @id @default(uuid())
  studentId      String   // Reference to User ID
  studentGender  String   @default("M") // Added for gender-based filtering
  reason         String
  fromTime       DateTime
  toTime         DateTime
  hours          Int      @default(0)
  requestedTime  DateTime @default(now())
  
  isExpired      Boolean  @default(false)
  isApproved     Boolean  @default(false)
  isRejected     Boolean  @default(false)
  
  issuedBy       String   @default("none")
  issuedTime     DateTime @default(now())
  message        String?
  rejectedBy     String   @default("none")
  rejectedTime   DateTime @default(now())
  
  checkedOutTime DateTime?
  checkedInTime  DateTime?
  
  currentLevel   String   @default("caretaker")
  approvalLogs  Json?

  @@index([studentId])
  @@index([isApproved, isRejected, isExpired])
}

model Grievance {
  id            String   @id @default(uuid())
  studentId     String?  // Optional: Null if truly anonymous
  studentEmail  String?
  category      String   // e.g., "Hostel", "Mess", "Academic", "Other"
  description   String
  isAnonymous   Boolean  @default(false)
  
  status        String   @default("pending") // pending, resolved
  resolvedBy    String?
  resolution    String?
  resolvedAt    DateTime?
  
  createdAt     DateTime @default(now())

  @@index([status])
  @@index([createdAt])
}
